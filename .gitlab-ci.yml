.build_template: &build_template
  stage: build
  variables:
    WORKSPACE: $CI_PROJECT_DIR
  script:
    - ./.ci/deb/install
    - ./.ci/deb/build
    - ./.ci/deb/post_build

pages:
  stage: build
  image: debian:stretch
  variables:
    LC_ALL: C.UTF-8
    LANG: C.UTF-8
  script:
    - apt-get update
    - apt-get install -y python3-pip
    - pip3 install sphinx sphinx_rtd_theme
    - make -C docs html
    - mv docs/_build/html/ public/
  artifacts:
    paths:
      - public
  only:
    - master

build_stretch:
  extends: .build_template
  image: debian:stretch
  # Check the code samples in the documentation
  after_script:
    - apt-get update
    - apt-get install -y python3-pip
    - pip3 install sphinx sphinx_rtd_theme
    - export LD_LIBRARY_PATH=install/lib
    - export PYTHONPATH=install/lib/python3/dist-packages/
    - make -C docs doctest

build_bionic:
  extends: .build_template
  image: ubuntu:bionic
